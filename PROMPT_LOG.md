# PROMPT_LOG.md - AIへの指示履歴

このファイルは、開発中にAIアシスタントへ出した主要な指示をまとめたものです。

---

## v0.2.1で実施した修正プロンプト
- ウィンドウ状態の完全復元。終了時の「最大化状態」「ウィンドウサイズ」「位置」「分割バーの位置」を記憶し、次回起動時に復元する。
- 録画ツールの起動を1つに制限する
- 出力のとき、MP4だけでなく、GIF形式で書き出す機能を増やす
- 録画のとき、マウスポインタの軌跡を動画の時刻とフレームとXとY座標でテキストファイルに記録して、録画完了と同時に動画と同じ名前で同じ場所に tsv形式で保存するようにして
- 録画の画質を選べるようにして。既定値の画質は今より高くして
- 「既に起動している場合は、警告を表示して終了」については、そうではなく開いているウィンドウを前面に表示するだけでOK
- マウスの軌跡のTSVを記録したとして、動画再生時は同名のTSVを読み込んでマウスポインタの描画を再現するかどうか選ぶチェックボックスを追加して
- 「既に起動している場合は、警告を表示して終了」については、そうではなく開いているウィンドウを前面に表示するだけでOK
- マウスの軌跡のTSVを記録したとして、動画再生時は同名のTSVを読み込んでマウスポインタの描画を再現するかどうか選ぶチェックボックスを追加して
- ボタンを押し込んでいる間の色がグレーの標準色に戻っている。
- UIをテーマカラーとしてアプリの設定ファイルに保存して、起動時に読み込むようにしてください。
- ボタンを押した時の処理を threading を使って別スレッドに逃がしたいです。GUIがフリーズしないように、重い処理を非同期で実行するコードパターンに書き換えてください。
- ウィンドウが表示されきった後（.after() メソッドなどを使用）に、シークバーのレイアウトを再計算・再描画する処理を追加したいです。起動の100ms後にリサイズ処理を走らせるコードを書いて。
- クロップ矩形をテーマカラーで定義できるように変更してください。線種、色、太さ（1ドットに対する太さ）など（未選択時：破線、選択時：実線）
- 設定保存、設定確認、設定再読み込みボタンで使用する設定ファイルは、アプリの実行ファイルと同じフォルダに配置するものとして確認修正してください。
- 「出力」フレームを整理して「設定」「PNG出力・コピー」「動画出力」の３つのフレーム（横並び）になおしてください。
- 動画再生・出力時にカーソルの位置を強調するための赤丸などをON/OFFで追加できるようにしてください。
- 新しい動画を開いた時に設定ファイルがない場合のStart、Endの既定値は、0と動画の最後までにしてください。
- Ctrl+Sで現在の囲っている範囲のフレームをPNGとして保存する機能を追加してください。
- 録画対象でウィンドウを選んでいるとき、ウィンドウの選択肢を名前の部分一致で絞り込める機能を追加してください。
- TSVに左右中のクリックボタンを押した瞬間の座標を記録する機能を追加してください。
- TSVに押されたショートカットキーを記録する機能を追加してください。

---

## 2026-02-05 (v0.2.2 開発)

- 初期色のままのすべてのボタンに色を付けて。
- ツールチップが設定されていないボタンにツールチップを追加して（ショートカットキーや解説など）
- 編集画面の動画キャンバス外の背景色を録画フォームと同じグレーにして
- アプリケーション設定で、ボタンや背景色などのデザインテーマを保存するようにして
- クロップ枠線の初期色は、未選択が橙破線で、選択時が赤破線にしてください。
- 四つ角のドットの色と大きさを設定ファイルで定義してください。
- クリック時のクロップ範囲サイズ変更を検知する太さも設定に追加してください。
- クロップの輪郭にマウスが乗った時のサイズ変更のクリックを検知するマージンですが、動画の拡大倍率によって変えてください。現在表示している線の太さ+設定値の数値が検知範囲です。そのため既定値は現在の値より少し減らしてください。

- Altキーを押しながらクロップのサイズ変更をしたら、10で割り切れる単位で変化するようにしてください。
- 動画の表示倍率を右上の解像度の隣に表示して
- ホイールで拡大縮小するときに、予定倍率が95%～105%になるとき100%にして
- X,Y,幅、高さのテキストボックスをStartのテキストと同じ高さまで大きくして
- マウスポインタをクロップ範囲内や枠線上を出入りする度に適切なものに変化させて

### クロップ枠線の設定
- 「枠線の色のデフォルトをオレンジにして」
- 「フォーカス状態（選択中）では赤い実線、ホバー状態では赤い破線、デフォルトではオレンジ破線にして」
- 「config.py のテーマ設定名を crop_default_linecolor / crop_focused_linecolor / crop_hover_linecolor のように統一して」

### 設定ファイル仕様変更
- 「古い設定名 (crop_color_unfocused, crop_dash_unfocused 等) から新しい設定名への自動移行 (migration) をサポートして」
- 「config.py に migration_map を追加して古い設定を新しいキー名に変換」

### ズーム機能の改善
- 「ホイールズームを100%にするにはレベル制にして」
- 「ズームするときビデオの中心ではなくキャンバスに映っているエリアを合わせて」

### UI視認性の向上
- 「X,Y,幅,高さのテキストボックスをStartのテキストと同じ高さまで大きくして」
- 「初期色のままのボタンにカラフルな色を付けて」
- 「戻す 進む ボタンを絵文字に変更。ボタンの色を他のハイコントラストのものにかえて」

### バグ修正
- ScreenRecorderApp で video_fps が未定義でクラッシュするバグを修正

---

## 2026-02-07 (v0.2.3 開発)

- 右上のパネル付近などに、動画の秒間フレーム数であるFPSを表示して
- png_compression や check_prev_next, check_duplicate, 再生設定, 軌跡表示は動画ごとに保存せず、アプリの共通設定に変更して
- 開始（Start）と終了（End）の色を、アプリの設定（theme）の `start_color_bg` / `end_color_bg` で共通化して
- 「動画を選択」などのボタンが、時々反応しなくなる問題を修正して
- `on_canvas_motion` の中のコメントを日本語にして。ロックされているときはマウスカーソルを「禁止マーク」に変えて
- 録画ツールでの削除・ダイアログ操作後に、録画ツールのウィンドウが背面に回らないよう最前面を維持して
- マウスポインタの形状を Windows 標準に近いリアルな矢印（`cursor`）に変更して。既定の枠線色も黒（`#000000`）に設定して
- 入力オーバーレイ（字幕）にマウスクリック（左・右・中）を文字として表示して。直前の入力を下にずらす「スタッキング」も実装して
- クリック情報の字幕枠を、ボタンの波紋色（赤・青・緑）で強調表示して。文字の縁取りとは独立して制御できるようにして
- アルファブレンド（透過合成）を正しく行い、字幕が「パッと消える」のではなく滑らかにフェードアウトするようにして。フェード時間は 0.5 秒に延長して
- 修飾キー（Ctrl, Shift等）のみが押されている間は字幕を表示しないようにフィルタリングして
- 「Ctrl + 左クリック」等の組み合わせを、標準的な順序（修飾キー＋マウス＋キー）で正しく記録・表示して
- `Page Up` / `Page Down` / `Home` / `End` / `F1`～`F12` 等の特殊キーも記録できるようにサポートを拡大して
- 録画したTSVの字幕を表示して（Y座標は1つ目=中央、5つ目=端）
- 詳細設定の変更は保存ボタンを押したら反映されるようにして
- 詳細設定では設定の変更内容を確認できるプレビュー画面を付けて
- 詳細設定の「検証」モード中は、メインウィンドウのショートカットキー（スペースでの再生停止など）が反応しないようにして
- 詳細設定とカラーピッカーダイアログは前面にモーダルとして表示されるようにして
- 詳細設定のプレビューで使用するロジックは、本番のポインタ病がや字幕描画とコードを共通化して
- 前回録画したときのデスクトップ・ウィンドウの設定値をアプリ設定で記憶して
- 録画画面の「対象」の下に座標x,yと解像度width,heightの入力ボックスと「更新」ボタンを追加して、選択したウィンドウの情報を表示して。更にユーザーが変更してEnterやTABで確定したら、逆にウィンドウの座標やサイズを書き換えて。
- 録画画面でウィンドウを絞り込むときにプロセス名も比較対象にして
- 録画画面でウィンドウの並び順をソートして
- 録画が始まるまでのカウントダウンをしてほしい。録画対象画面の中央にカウントダウン文字を出したい
- 録画のときに対象画面範囲を示す赤枠が録画に含まれないような方法を模索して欲しい
- WGCで選択したウィンドウのみキャプチャする(Win10以降)」を実装して

## 2026-02-11 (v0.3.0-beta 開発)

### ショートカットキー設定ダイアログを追加して。

### 録画対象の周りに表示している枠線の改善
- 録画開始前は黄色で、録画が始まったら赤にしてください。
- 立体感を出すために単色ではなく３色グラデーションにしてください。
- 色の定義や描画部分は共通部分を関数化してください。
- WGCによるウィンドウキャプチャでは、該当ウィンドウが背面にあるときは赤枠を表示する必要がないので、枠線のZオーダーは対象ウィンドウの1つ後にして
- 録画準備中の外側と内側の色は699483。間の3ピクセルは97dc44という色にしてください。
- 録画中は外側がaa0000、間の3ピクセルがff3030、内側は待機中と同じ699483という色です。

### 録画プレビュー画面の修正
- プレビュー画面に、設定に基づいたクリックや字幕などの演出を表示して欲しい
- プレビュー画面の描画が録画と一致していません。クリックしたまま離していないのに波紋が広がる演出がおきています。また、クリック中の赤枠が維持されません。字幕も消えてしまいます。
- プレビュー画面に表示しきれていないときがあります。マルチスレッド等により描画を高速化してください。

### 仮想WEBカメラ配信機能の追加
- プレビュー映像を仮想WEBカメラとしてデバイスに映像配信したいのですがそれは可能でしょうか。どのようなライブラリが必要で容量はどのくらい増えそうですか？実装前に教えて下さい
- Unity Captureで実装をお願いします。
- 仮想カメラ配信はトグルボタンで、録画開始ボタンの右隣に設置して
- 仮想カメラ配信トグルボタンの押す前と押した後の色は、録画開始と同じにして
- フォーム表示時に仮想カメラドライバがインストールされているか調べて、あったかどうかでボタンの有効無効を切り替えて
- UnityCaptuireがインストールされていない場合は確認を表示した後にバックグラウンドインストールを行えるようにして。なお、リポジトリのZIPからはInstall.batが見つけられない場合があるため、ZIPの展開結果からファイルを全探索して見つけてください。仮想カメラドライバのインストールが終わった後、インストール状態を再確認して、無効にしたボタンの有効無効状態を更新してください。
- 仮想カメラ配信をOFFにするとき。配信先映像を信号がないことを表す表示（真っ黒の背景に白文字で中央にNo Signal）に変えて。配信中にフォームを閉じるときにも送る必要がある。
- カメラドライバ導入ボタンの名前を「導入」に変えて、仮想カメラ配信ボタンの右に移動して。また、ドライバが検知できているときは無効化して
- 仮想カメラ配信 は既定でOFFです。設定に保存して復元する必要はありません。
- 録画開始・終了をしたとしても、仮想カメラ配信のトグルボタンを無効化する必要はありません。
- 録画開始を押して、録画が始まった直後にターミナルに残るログの表示の危険度を表示して

### 録画機能の改善
- 録画のFPSと画質は、変更と同時にアプリ設定に保存して、起動時に復元してください。
- 録画画面の「録画枠を表示」と「プレビューに演出を表示」も変更と同時にアプリ設定に保存して、起動時に復元してください。
- 録画開始直後のカウントダウン中に停止ボタンを押したら、録画準備を中断できるようにして。
- 仮想カメラ配信をオフにしたときに、映像をクローズする前に「No Signal」画面を数フレーム表示して。
- WGCのウィンドウモードで録画しているとき、最前面のプロセスが対象のウィンドウではないとき、マウス波紋表示やキー入力の記録や字幕のプレビュー表示からは除外して
- コード全体をリファクタリングしてください

#### 以下の通りボタンの既定の色をパステルカラーで設定して設定に保存・起動時に読み取るようにしてください。
- 「...」：オレンジ系
- 「操作ログを開く」：青系
- 「キー設定」：「詳細設定」と同じオレンジ系
- 「閉じる」：グレー
- 「導入」：グレー
- 「▶」：青系

